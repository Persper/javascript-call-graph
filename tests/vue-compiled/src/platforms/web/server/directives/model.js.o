'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = model;

var _util = require('shared/util');

// this is only applied for <select v-model> because it is the only edge case
// that must be done at runtime instead of compile time.
function model(node, dir) {
  if (!node.children) return;
  var value = dir.value;
  var isMultiple = node.data.attrs && node.data.attrs.multiple;
  for (var i = 0, l = node.children.length; i < l; i++) {
    var option = node.children[i];
    if (option.tag === 'option') {
      if (isMultiple) {
        var selected = Array.isArray(value) && (0, _util.looseIndexOf)(value, getValue(option)) > -1;
        if (selected) {
          setSelected(option);
        }
      } else {
        if ((0, _util.looseEqual)(value, getValue(option))) {
          setSelected(option);
          return;
        }
      }
    }
  }
}

function getValue(option) {
  var data = option.data || {};
  return data.attrs && data.attrs.value || data.domProps && data.domProps.value || option.children && option.children[0] && option.children[0].text;
}

function setSelected(option) {
  var data = option.data || (option.data = {});
  var attrs = data.attrs || (data.attrs = {});
  attrs.selected = '';
}

