'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.compileWithWebpack = compileWithWebpack;

var _path = require('path');

var _path2 = _interopRequireDefault(_path);

var _webpack = require('webpack');

var _webpack2 = _interopRequireDefault(_webpack);

var _memoryFs = require('memory-fs');

var _memoryFs2 = _interopRequireDefault(_memoryFs);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function compileWithWebpack(file, extraConfig, cb) {
  var config = Object.assign({
    entry: _path2.default.resolve(__dirname, 'fixtures', file),
    module: {
      rules: [{
        test: /\.js$/,
        loader: 'babel-loader'
      }, {
        test: /async-.*\.js$/,
        loader: require.resolve('./async-loader')
      }, {
        test: /\.(png|woff2|css)$/,
        loader: 'file-loader',
        options: {
          name: '[name].[ext]'
        }
      }]
    }
  }, extraConfig);

  var compiler = (0, _webpack2.default)(config);
  var fs = new _memoryFs2.default();
  compiler.outputFileSystem = fs;

  compiler.run(function (err, stats) {
    expect(err).toBeFalsy();
    expect(stats.errors).toBeFalsy();
    cb(fs);
  });
}

